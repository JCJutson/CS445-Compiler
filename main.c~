/*
 * This version, migrated from your last HW, might need further adaptation
 * in order to work with a Bison parser.
 */
#include "scanType.h"
#include "treenode.h"
#include "parsercpp.tab.h"
#include <iostream>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
extern FILE *yyin;
extern char *yytext;
extern int yydebug;
extern int lineNum;
extern int numErrors;
extern int numWarnings;
extern char *yyfilename;
extern TreeNode *treeRoot;

int main(int argc, char *argv[])
{
	int i,t,opt;
	bool printTree = false, printTypedTree = false;
	while ((opt = getopt(argc, argv, "d")) != -1){
	        switch(opt){
		case 'd':
       		yydebug = 1;
			break;
		case 'p':
			printTree = true;
			break;
		case 'P':
			printTree = true;
			printTypedTree = true;
		default:
		    abort();
		}
	}
	
	
	if (optind < argc)
	{
		yyin = fopen(argv[optind],"r");
		if (yyin == NULL) 
		{ 
			printf("Can't open/read '%s'\n", argv[optind]); 
			exit(-1); 
		}
		yyfilename = argv[optind];
	}
	
	i = yyparse();
	if(printTree)
		treeRoot->print();
	std::cout << "Number of warnings: " << numWarnings << std::endl;
	std::cout << "Number of errors: " << numErrors << std::endl;
		/*
		if (i != 0) {
			printf("parse failed\n");
		}
		else {
			printf("no errors\n");
			if(treeRoot != NULL){
				treeRoot->print();
			}
		}
		*/
	
	
	return 0;
}
